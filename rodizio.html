<!DOCTYPE html><html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rodízio de Cultos — Gerador Automático</title><style>
:root{
  --border:#d0d0d0;
  --blue:#e8f0ff;
  --orange:#fff1dc;
  --red:#fde2e2;
}
body{
  font-family:Arial, sans-serif;
  margin:0;
  background:#f4f6f8;
}
.wrap{
  max-width:900px;
  margin:20px auto;
  padding:16px;
  background:#fff;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.08)
}
h1{text-align:center;margin:0;font-size:26px}
.sub{text-align:center;color:#555;margin-bottom:16px}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  margin-bottom:16px
}
select,input,button{
  padding:10px;
  font-size:14px;
  border-radius:6px;
  border:1px solid #ccc
}
button{cursor:pointer}
.btn-primary{background:#2563eb;color:#fff;border:none}
.btn-pdf{background:#c62828;color:#fff;border:none}
.panel{margin-bottom:16px}
.card{border:1px solid var(--border);border-radius:8px;padding:12px}
.card h3{margin-top:0}
textarea{width:100%;min-height:80px;padding:8px;border-radius:6px;border:1px solid #ccc}
.title-bar{
  text-align:center;
  font-weight:bold;
  padding:8px;
  margin-top:20px;
  border-radius:6px;
  background:#eee
}
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid var(--border);padding:8px;text-align:left}
th{background:#f1f1f1}
@media(max-width:600px){
  h1{font-size:22px}
}
</style><script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script></head>
<body>
<div class="wrap">
<h1>RODÍZIO — <span id="previewMes"></span></h1>
<div class="sub">Congregação Cristã no Brasil</div><div class="controls">
  <input type="month" id="monthPick"/>
  <button class="btn-primary" onclick="gerarRodizio()">Gerar Rodízio</button>
  <button class="btn-pdf" onclick="exportPDF()">Exportar PDF</button>
</div><div class="controls">
  <select id="savedList">
    <option value="">Rodízios salvos</option>
  </select>
  <button onclick="loadSaved()">Carregar</button>
</div><div class="panel">
<div class="card">
<h3>Operadores (um por linha)</h3>
<label>Cultos (Dom / Ter / Qui)</label>
<textarea id="opsCulto">ABIMAEL
DANIEL
FABIO
JONATAS</textarea>
<label>Reunião de Jovens</label>
<textarea id="opsReuniao">ABIMAEL
DANIEL FEIRA NOVA</textarea>
<label>Ensaio</label>
<textarea id="opsEnsaio">JONATAS</textarea>
<label>Culto de Jovens</label>
<textarea id="opsCultoJovem">FABIO</textarea>
</div>
</div><div id="resultArea"></div>
</div><script>
const monthShort=['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];
const dayName=['domingo','segunda','terça','quarta','quinta','sexta','sábado'];
function parse(t){return t.split('\n').map(x=>x.trim()).filter(Boolean)}
function daysInMonth(y,m){return new Date(y,m+1,0).getDate()}
function allWeekdays(y,m,days){let a=[];for(let d=1;d<=daysInMonth(y,m);d++){let dt=new Date(y,m,d);if(days.includes(dt.getDay()))a.push(dt)}return a}
function nthWeekday(y,m,w,n){let c=0;for(let d=1;d<=daysInMonth(y,m);d++){let dt=new Date(y,m,d);if(dt.getDay()==w){c++;if(c==n)return dt}}return null}
function fmt(dt){return dt.getDate()+'/'+(dt.getMonth()+1)}

function gerarRodizio(){
  const mv=monthPick.value;if(!mv)return alert('Escolha o mês');
  const [y,m]=mv.split('-').map(Number);const mi=m-1;
  previewMes.textContent=monthShort[mi].toUpperCase()+' '+y;

  const c=parse(opsCulto.value), r=parse(opsReuniao.value), e=parse(opsEnsaio.value), j=parse(opsCultoJovem.value);
  let pc=0,pr=0,pe=0,pj=0;

  let out='';
  out+=section('CULTOS', allWeekdays(y,mi,[0,2,4]).map(dt=>row(dt,c[pc++%c.length])));
  out+=section('REUNIÃO DE JOVENS', allWeekdays(y,mi,[0]).map(dt=>row(dt,r[pr++%r.length])));
  const ef=nthWeekday(y,mi,5,2); if(ef) out+=section('ENSAIO',[row(ef,e[0])]);
  const cj=nthWeekday(y,mi,6,2); if(cj) out+=section('CULTO DE JOVENS',[row(cj,j[0])]);

  resultArea.innerHTML=out;
  localStorage.setItem(`rodizio-${monthShort[mi]}-${y}`, out);
  updateSavedList();
}

function section(t,rows){
  let h=`<div class="title-bar">${t}</div><table><tr><th>Dia</th><th>Data</th><th>Irmão</th></tr>`;
  rows.forEach(r=>h+=`<tr><td>${r.dia}</td><td>${r.data}</td><td>${r.nome}</td></tr>`);
  return h+='</table>';
}
function row(dt,n){return{dia:dayName[dt.getDay()],data:fmt(dt),nome:n}}

function updateSavedList(){
  savedList.innerHTML='<option value="">Rodízios salvos</option>';
  Object.keys(localStorage).filter(k=>k.startsWith('rodizio-')).sort().forEach(k=>{
    const o=document.createElement('option');o.value=k;o.textContent=k.replace('rodizio-','').toUpperCase();savedList.appendChild(o);
  })
}
function loadSaved(){if(!savedList.value)return;resultArea.innerHTML=localStorage.getItem(savedList.value)}
function exportPDF(){html2pdf().from(resultArea).set({filename:'rodizio.pdf',html2canvas:{scale:2}}).save()}

const now=new Date();monthPick.value=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0');gerarRodizio();updateSavedList();
</script></body>
</html>
