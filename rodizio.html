<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rodízio de Cultos — Gerador Automático</title>

<style>
:root{
  --border:#7a7a7a;
  --blue:#dbe7ff;
  --orange:#f4e0c8;
  --red:#f8d6d6;
}
body{font-family:Arial;margin:0;background:#f7f7f7}
.wrap{max-width:1100px;margin:18px auto;padding:16px;background:#fff}
h1{text-align:center}
.controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
button{padding:8px;cursor:pointer}
.btn-primary{background:#2e6be6;color:#fff;border:0}
.btn-save{background:#2e7d32;color:#fff;border:0}
table{width:100%;border-collapse:collapse;margin-bottom:20px}
th,td{border:1px solid #777;padding:8px;text-align:left}
th{background:#eee}
.batismo{background:#ffe082;font-weight:bold}
.badge{padding:3px 6px;background:#c62828;color:#fff;font-size:12px;border-radius:4px}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
<div class="wrap">
<h1>RODÍZIO MÊS DE <span id="previewMes"></span></h1>
<div style="text-align:center">Congregação Cristã no Brasil</div>

<div class="controls">
  <input id="monthPick" type="month"/>
  <button class="btn-primary" onclick="gerarRodizio()">Gerar</button>
  <button class="btn-save" onclick="salvarRodizio()">Salvar Rodízio</button>
</div>

<div id="resultArea"></div>
</div>

<script>
const monthShort=['JAN','FEV','MAR','ABR','MAI','JUN','JUL','AGO','SET','OUT','NOV','DEZ'];
const dayName=['domingo','segunda','terça','quarta','quinta','sexta','sábado'];

function fmt(dt){return dt.getDate()+'-'+monthShort[dt.getMonth()]}
function days(y,m){return new Date(y,m+1,0).getDate()}

function gerarRodizio(){
  const m=document.getElementById('monthPick').value;
  if(!m) return alert('Selecione o mês');
  const [y,mo]=m.split('-').map(Number);
  document.getElementById('previewMes').innerText=monthShort[mo-1]+' '+y;

  let rows='';
  for(let d=1;d<=days(y,mo-1);d++){
    const dt=new Date(y,mo-1,d);
    if([0,2,4].includes(dt.getDay())){
      rows+=linha(dt,'ABIMAEL');
    }
  }
  document.getElementById('resultArea').innerHTML=tabela(rows);
  carregarBatismos();
}

function tabela(rows){
  return `
  <table>
  <tr><th>DIA</th><th>DATA</th><th>IRMÃO</th><th>EVENTO</th></tr>
  ${rows}
  </table>`;
}

function linha(dt,irmao){
  const id=dt.toISOString().slice(0,10);
  return `
  <tr id="${id}">
    <td>${dayName[dt.getDay()]}</td>
    <td>${fmt(dt)}</td>
    <td>${irmao}</td>
    <td>
      <button onclick="toggleBatismo('${id}')">Batismo</button>
      <span class="badge" style="display:none">BATISMO</span>
    </td>
  </tr>`;
}

/* ===== BATISMO ===== */
function toggleBatismo(id){
  const tr=document.getElementById(id);
  tr.classList.toggle('batismo');
  tr.querySelector('.badge').style.display=
    tr.classList.contains('batismo')?'inline':'none';
  salvarRodizio();
}

/* ===== SALVAR ===== */
function salvarRodizio(){
  const mes=document.getElementById('monthPick').value;
  localStorage.setItem('rodizio-'+mes,
    document.getElementById('resultArea').innerHTML);
  salvarBatismos();
  alert('Rodízio salvo!');
}

function carregarRodizio(){
  const mes=document.getElementById('monthPick').value;
  const data=localStorage.getItem('rodizio-'+mes);
  if(data){
    document.getElementById('resultArea').innerHTML=data;
    carregarBatismos();
  }
}

/* ===== BATISMOS SALVOS ===== */
function salvarBatismos(){
  const batismos=[];
  document.querySelectorAll('.batismo').forEach(tr=>batismos.push(tr.id));
  localStorage.setItem('batismos-'+monthPick.value,JSON.stringify(batismos));
}

function carregarBatismos(){
  const list=JSON.parse(localStorage.getItem('batismos-'+monthPick.value)||'[]');
  list.forEach(id=>{
    const tr=document.getElementById(id);
    if(tr){
      tr.classList.add('batismo');
      tr.querySelector('.badge').style.display='inline';
    }
  });
}

/* AUTO */
const now=new Date();
monthPick.value=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0');
gerarRodizio();
carregarRodizio();
</script>
</body>
</html>
