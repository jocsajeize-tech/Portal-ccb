<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Rodízio Mensal - CCB</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:15px}
h1{text-align:center}
select,button{padding:8px;margin:5px;font-size:16px}
table{width:100%;border-collapse:collapse;margin-top:15px;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#eee}
tr.batismo{background:#ffe0e0}
.card{background:#fff;padding:10px;margin-top:10px;border-radius:6px}
</style>
</head>
<body>

<h1>Rodízio Mensal<br><small>Congregação Cristã no Brasil</small></h1>

<select id="mes"></select>
<button onclick="gerar()">Gerar e Salvar</button>
<button onclick="exportar()">Exportar PDF</button>

<div id="resultado"></div>

<script>
const irmaos = ["ABIMAEL","DANIEL","FÁBIO","JONATAS","DANIEL FEIRA NOVA"];
const eventos = [
 {nome:"Culto",dias:[0,2,4]},
 {nome:"Reunião de Jovens",dias:[6]},
 {nome:"Ensaio",dias:[5]},
 {nome:"Culto de Jovens",dias:[6]}
];

const mesSelect = document.getElementById("mes");
for(let m=0;m<12;m++){
 let d=new Date(2026,m,1);
 mesSelect.innerHTML+=`<option value="${m}">${d.toLocaleString("pt-BR",{month:"long"})} / 2026</option>`;
}

function gerar(){
 let mes = mesSelect.value;
 let ano = 2026;
 let dados=[];
 let idx=0;

 let diasNoMes=new Date(ano,Number(mes)+1,0).getDate();
 for(let e of eventos){
   for(let d=1;d<=diasNoMes;d++){
     let data=new Date(ano,mes,d);
     if(e.dias.includes(data.getDay())){
       dados.push({
         evento:e.nome,
         dia:data.toLocaleDateString("pt-BR",{weekday:"short"}),
         data:d,
         irmao:irmaos[idx%irmaos.length],
         batismo:false
       });
       idx++;
     }
   }
 }

 localStorage.setItem("rodizio_"+mes,JSON.stringify(dados));
 render(dados,mes);
}

function render(dados,mes){
 let html="";
 eventos.forEach(ev=>{
   html+=`<div class="card"><h3>${ev.nome}</h3><table>
   <tr><th>Dia</th><th>Data</th><th>Irmão</th><th>Obs</th></tr>`;
   dados.filter(d=>d.evento===ev.nome).forEach((d,i)=>{
     html+=`<tr class="${d.batismo?"batismo":""}" onclick="toggleBatismo(${mes},'${ev.nome}',${i})">
     <td>${d.dia}</td><td>${d.data}</td><td>${d.irmao}</td>
     <td>${d.batismo?"BATISMO":""}</td></tr>`;
   });
   html+="</table></div>";
 });
 document.getElementById("resultado").innerHTML=html;
}

function toggleBatismo(mes,evento,index){
 let dados=JSON.parse(localStorage.getItem("rodizio_"+mes));
 let cont=0;
 for(let d of dados){
   if(d.evento===evento){
     if(cont===index){
       d.batismo=!d.batismo;
       break;
     }
     cont++;
   }
 }
 localStorage.setItem("rodizio_"+mes,JSON.stringify(dados));
 render(dados,mes);
}

function exportar(){
 window.print();
}

mesSelect.onchange=()=>{
 let dados=localStorage.getItem("rodizio_"+mesSelect.value);
 if(dados) render(JSON.parse(dados),mesSelect.value);
};
</script>

</body>
</html>
